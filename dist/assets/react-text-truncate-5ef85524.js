import{b as Y}from"./@babel-7eadaf80.js";import{r as Z}from"./react-4ec858dc.js";import{r as ee}from"./prop-types-37a46aa4.js";var S={},te={get exports(){return S},set exports(W){S=W}};(function(W,U){(function(x,d){d(U,Z,ee())})(void 0,function(x,d,$){Object.defineProperty(x,"__esModule",{value:!0}),x.default=void 0;var B=L(d),f=L($);function L(t){return t&&t.__esModule?t:{default:t}}function O(t){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?O=function(r){return typeof r}:O=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},O(t)}function q(t,n){if(t==null)return{};var r=G(t,n),e,o;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);for(o=0;o<a.length;o++)e=a[o],!(n.indexOf(e)>=0)&&Object.prototype.propertyIsEnumerable.call(t,e)&&(r[e]=t[e])}return r}function G(t,n){if(t==null)return{};var r={},e=Object.keys(t),o,a;for(a=0;a<e.length;a++)o=e[a],!(n.indexOf(o)>=0)&&(r[o]=t[o]);return r}function H(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function D(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function J(t,n,r){return n&&D(t.prototype,n),r&&D(t,r),t}function K(t,n){return n&&(O(n)==="object"||typeof n=="function")?n:h(t)}function I(t){return I=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},I(t)}function h(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Q(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&z(t,n)}function z(t,n){return z=Object.setPrototypeOf||function(e,o){return e.__proto__=o,e},z(t,n)}function y(t,n,r){return n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}var V=1e-4,M=function(n,r){return Math.abs(n-r)<V},R=function(t){Q(n,t);function n(){var r,e;H(this,n);for(var o=arguments.length,a=new Array(o),s=0;s<o;s++)a[s]=arguments[s];return e=K(this,(r=I(n)).call.apply(r,[this].concat(a))),y(h(e),"onResize",function(){e.rafId&&window.cancelAnimationFrame(e.rafId),e.rafId=window.requestAnimationFrame(e.update.bind(h(e)))}),y(h(e),"onToggled",function(l){typeof e.props.onToggled=="function"&&setTimeout(function(){return e.props.onToggled(l)},0)}),y(h(e),"onTruncated",function(){typeof e.props.onTruncated=="function"&&setTimeout(function(){return e.props.onTruncated()},0)}),y(h(e),"onCalculated",function(){typeof e.props.onCalculated=="function"&&setTimeout(function(){return e.props.onCalculated()},0)}),y(h(e),"update",function(){var l=window.getComputedStyle(e.scope),p=[l["font-weight"],l["font-style"],l["font-size"],l["font-family"],l["letter-spacing"]].join(" ");e.canvas.font=p,e.forceUpdate()}),e}return J(n,[{key:"componentDidMount",value:function(){var e=document.createElement("canvas"),o=document.createDocumentFragment(),a=window.getComputedStyle(this.scope),s=[a["font-weight"],a["font-style"],a["font-size"],a["font-family"]].join(" ");o.appendChild(e),this.canvas=e.getContext("2d"),this.canvas.font=s,this.forceUpdate(),window.addEventListener("resize",this.onResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.onResize),this.rafId&&window.cancelAnimationFrame(this.rafId)}},{key:"measureWidth",value:function(e){return this.canvas.measureText(e).width}},{key:"getRenderText",value:function(){var e=this.props;e.containerClassName,e.element;var o=e.line;e.onCalculated,e.onTruncated,e.onToggled;var a=e.text,s=e.textElement,l=e.textTruncateChild,p=e.truncateText,j=e.maxCalculateTimes,g=q(e,["containerClassName","element","line","onCalculated","onTruncated","onToggled","text","textElement","textTruncateChild","truncateText","maxCalculateTimes"]),m=this.scope.getBoundingClientRect().width;if(m===0)return null;var E=this.measureWidth(a);if(m>E||M(m,E))return this.onToggled(!1),(0,d.createElement)(s,g,a);var b="";if(l&&typeof l.type=="string"){var _=l.type;(_.indexOf("span")>=0||_.indexOf("a")>=0)&&(b=l.props.children)}for(var i=1,T=a.length,u="",w=0,c=0,v=o,C=0,P=!1,A=!1,F=0,k=-1,N="",X=0;v-- >0;){for(N=v?"":p+(b?" "+b:"");i<=T;)if(u=a.substr(c,i),C=this.measureWidth(u+N),C<m)w=a.indexOf(" ",i+1),w===-1?(i+=1,P=!1):(P=!0,i=w);else{do{if(X++>=j)break;u=a.substr(c,i),v||i--,u[u.length-1]===" "&&(u=a.substr(c,i-1)),P?(k=u.lastIndexOf(" "),k>-1?(i=k,v&&i++,u=a.substr(c,i)):(i--,u=a.substr(c,i))):(i--,u=a.substr(c,i)),C=this.measureWidth(u+N)}while((C>m||M(C,m))&&u.length>0);c+=i;break}if(i>=T){c=T;break}P&&!A&&a.substr(F,i).indexOf(" ")===-1&&(A=a.substr(F,i).indexOf(" ")===-1,v--),F=i+1}return c===T?(this.onToggled(!1),(0,d.createElement)(s,g,a)):(this.onTruncated(),this.onToggled(!0),B.default.createElement("span",g,(0,d.createElement)(s,g,a.substr(0,c)+p+" "),l))}},{key:"render",value:function(){var e=this,o=this.props,a=o.element,s=o.text,l=o.style,p=l===void 0?{}:l,j=o.containerClassName,g=o.line;o.onCalculated,o.onTruncated,o.onToggled;var m=o.textElement;o.textTruncateChild,o.truncateText,o.maxCalculateTimes;var E=q(o,["element","text","style","containerClassName","line","onCalculated","onTruncated","onToggled","textElement","textTruncateChild","truncateText","maxCalculateTimes"]),b=p.fontWeight,_=p.fontStyle,i=p.fontSize,T=p.fontFamily,u=this.scope&&g?this.getRenderText():(0,d.createElement)(m,E,s),w={ref:function(v){e.scope=v},className:j,style:{overflow:"hidden",fontWeight:b,fontStyle:_,fontSize:i,fontFamily:T}};return this.scope&&this.onCalculated(),(0,d.createElement)(a,w,u)}}]),n}(d.Component);y(R,"propTypes",{containerClassName:f.default.string,element:f.default.string,line:f.default.oneOfType([f.default.number,f.default.bool]),onCalculated:f.default.func,onTruncated:f.default.func,onToggled:f.default.func,text:f.default.string,textElement:f.default.elementType,textTruncateChild:f.default.node,truncateText:f.default.string,maxCalculateTimes:f.default.number}),y(R,"defaultProps",{element:"div",line:1,text:"",textElement:"span",truncateText:"â€¦",maxCalculateTimes:10}),x.default=R,W.exports=x.default})})(te,S);const ae=Y(S);export{ae as T};
